<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Manager Pro - Professional Inventory System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            scroll-behavior: smooth;
        }

        html:not(.dark) {
            background-color: #f8fafc;
            color: #0f172a;
        }

        html.dark {
            background-color: #0d1117;
            color: #e6edf3;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background-color 0.2s ease, color 0.2s ease;
            overflow-x: hidden;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        html.dark ::-webkit-scrollbar-thumb {
            background: #30363d;
        }

        html.dark ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        .hidden {
            display: none !important;
        }

        .auth-screen {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .auth-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            padding: 40px;
        }

        html.dark .auth-container {
            background: #161b22;
            color: #e6edf3;
        }

        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auth-subtitle {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 28px;
        }

        html.dark .auth-subtitle {
            color: #8b949e;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 6px;
            color: #334155;
        }

        html.dark .form-group label {
            color: #c9d1d9;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s ease;
        }

        html.dark .form-group input,
        html.dark .form-group select {
            background: #0d1117;
            border-color: #30363d;
            color: #e6edf3;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
            margin-top: 8px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #334155;
        }

        html.dark .btn-secondary {
            background: #30363d;
            color: #c9d1d9;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        html.dark .btn-secondary:hover {
            background: #484f58;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }

        .text-muted {
            color: #64748b;
            font-size: 13px;
        }

        html.dark .text-muted {
            color: #8b949e;
        }

        .main-container {
            display: flex;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            padding: 24px 0;
            overflow-y: auto;
        }

        html.dark .sidebar {
            background: #161b22;
            border-right-color: #30363d;
        }

        .sidebar-header {
            padding: 0 20px;
            margin-bottom: 24px;
        }

        .sidebar-title {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 4px;
        }

        .sidebar-subtitle {
            color: #64748b;
            font-size: 12px;
        }

        html.dark .sidebar-subtitle {
            color: #8b949e;
        }

        .sidebar-menu {
            list-style: none;
            flex: 1;
        }

        .sidebar-menu-item {
            padding: 0;
            margin: 0;
        }

        .sidebar-menu-item a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #64748b;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer;
            border-left: 3px solid transparent;
            font-size: 14px;
        }

        html.dark .sidebar-menu-item a {
            color: #8b949e;
        }

        .sidebar-menu-item a:hover {
            background: #f1f5f9;
            color: #334155;
            border-left-color: #667eea;
        }

        html.dark .sidebar-menu-item a:hover {
            background: #21262d;
            color: #c9d1d9;
            border-left-color: #667eea;
        }

        .sidebar-menu-item a.active {
            background: #f1f5f9;
            color: #667eea;
            border-left-color: #667eea;
            font-weight: 600;
        }

        html.dark .sidebar-menu-item a.active {
            background: #21262d;
            color: #58a6ff;
            border-left-color: #58a6ff;
        }

        .sidebar-section-title {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #94a3b8;
            padding: 16px 20px 8px;
            margin-top: 12px;
        }

        html.dark .sidebar-section-title {
            color: #6e7681;
        }

        .sidebar-footer {
            border-top: 1px solid #e2e8f0;
            padding: 16px 20px;
            display: flex;
            gap: 8px;
        }

        html.dark .sidebar-footer {
            border-top-color: #30363d;
        }

        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        html.dark .header {
            background: #161b22;
            border-bottom-color: #30363d;
        }

        .header-title {
            font-size: 20px;
            font-weight: 700;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: background 0.2s ease;
        }

        .user-profile:hover {
            background: #f1f5f9;
        }

        html.dark .user-profile:hover {
            background: #21262d;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-size: 13px;
            font-weight: 600;
        }

        .user-email {
            font-size: 11px;
            color: #64748b;
        }

        html.dark .user-email {
            color: #8b949e;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
        }

        .items-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .items-count {
            font-size: 28px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .items-count-number {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 48px;
            height: 48px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .search-input {
            padding: 10px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
            width: 250px;
            font-family: inherit;
        }

        html.dark .search-input {
            background: #0d1117;
            border-color: #30363d;
            color: #e6edf3;
        }

        .search-input::placeholder {
            color: #94a3b8;
        }

        html.dark .search-input::placeholder {
            color: #6e7681;
        }

        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        html.dark .table-container {
            background: #161b22;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        html.dark thead {
            background: #0d1117;
            border-bottom-color: #30363d;
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #64748b;
        }

        html.dark th {
            color: #8b949e;
        }

        td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
        }

        html.dark td {
            border-bottom-color: #30363d;
        }

        tbody tr:hover {
            background: #f8fafc;
        }

        html.dark tbody tr:hover {
            background: #0d1117;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-available {
            background: #dcfce7;
            color: #166534;
        }

        html.dark .status-available {
            background: #0d3c1d;
            color: #3fb950;
        }

        .status-out {
            background: #fed7aa;
            color: #92400e;
        }

        html.dark .status-out {
            background: #3d2817;
            color: #d29922;
        }

        .condition-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .condition-working {
            background: #dcfce7;
            color: #166534;
        }

        html.dark .condition-working {
            background: #0d3c1d;
            color: #3fb950;
        }

        .condition-notworking {
            background: #fecaca;
            color: #991b1b;
        }

        html.dark .condition-notworking {
            background: #3d1010;
            color: #f85149;
        }

        .condition-na {
            background: #e5e7eb;
            color: #374151;
        }

        html.dark .condition-na {
            background: #30363d;
            color: #8b949e;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .action-btn-edit {
            background: #fef3c7;
            color: #92400e;
        }

        .action-btn-edit:hover {
            background: #fde68a;
        }

        html.dark .action-btn-edit {
            background: #3d2817;
            color: #d29922;
        }

        html.dark .action-btn-edit:hover {
            background: #54410e;
        }

        .action-btn-history {
            background: #dbeafe;
            color: #1e40af;
        }

        .action-btn-history:hover {
            background: #bfdbfe;
        }

        html.dark .action-btn-history {
            background: #0d2a47;
            color: #58a6ff;
        }

        html.dark .action-btn-history:hover {
            background: #1f47a3;
        }

        .action-btn-assign {
            background: #d1fae5;
            color: #065f46;
        }

        .action-btn-assign:hover {
            background: #a7f3d0;
        }

        html.dark .action-btn-assign {
            background: #0d3c1d;
            color: #3fb950;
        }

        html.dark .action-btn-assign:hover {
            background: #166a45;
        }

        .action-btn-delete {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn-delete:hover {
            background: #fecaca;
        }

        html.dark .action-btn-delete {
            background: #3d1010;
            color: #f85149;
        }

        html.dark .action-btn-delete:hover {
            background: #5a1515;
        }

        .action-btn-add-qty {
            background: #e0e7ff;
            color: #3730a3;
        }

        .action-btn-add-qty:hover {
            background: #c7d2fe;
        }

        html.dark .action-btn-add-qty {
            background: #262e56;
            color: #818cf8;
        }

        html.dark .action-btn-add-qty:hover {
            background: #3a4266;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalSlideIn 0.3s ease;
        }

        html.dark .modal-content {
            background: #161b22;
            color: #e6edf3;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .modal-body {
            margin-bottom: 24px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .message {
            padding: 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .message-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        html.dark .message-success {
            background: #0d3c1d;
            color: #3fb950;
            border-color: #238636;
        }

        .message-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        html.dark .message-error {
            background: #3d1010;
            color: #f85149;
            border-color: #da3633;
        }

        .message-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        html.dark .message-warning {
            background: #3d2817;
            color: #d29922;
            border-color: #8b6914;
        }

        .message-icon {
            flex-shrink: 0;
            font-size: 18px;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            padding: 16px 20px;
            border-radius: 6px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            animation: toastSlideIn 0.3s ease;
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        html.dark .toast-success {
            background: #0d3c1d;
            color: #3fb950;
            border-color: #238636;
        }

        .toast-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        html.dark .toast-error {
            background: #3d1010;
            color: #f85149;
            border-color: #da3633;
        }

        .toast-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        html.dark .toast-warning {
            background: #3d2817;
            color: #d29922;
            border-color: #8b6914;
        }

        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 16px;
        }

        .member-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            transition: all 0.2s ease;
        }

        html.dark .member-card {
            background: #161b22;
            border-color: #30363d;
        }

        .member-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: #667eea;
        }

        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 16px;
        }

        .member-name {
            font-weight: 600;
            font-size: 15px;
        }

        .member-info {
            color: #64748b;
            font-size: 12px;
            margin-bottom: 8px;
        }

        html.dark .member-info {
            color: #8b949e;
        }

        .member-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .loading-screen {
            position: fixed;
            inset: 0;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            flex-direction: column;
            gap: 20px;
        }

        html.dark .loading-screen {
            background: #0d1117;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        html.dark .spinner {
            border-color: #30363d;
            border-top-color: #58a6ff;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 1px solid #e2e8f0;
                padding: 12px 0;
            }

            table {
                font-size: 12px;
            }

            td, th {
                padding: 12px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="spinner"></div>
        <div id="loadingMessage" style="color: #64748b; font-weight: 600;">Loading inventory...</div>
    </div>

    <!-- Auth Screen -->
    <div id="authScreen" class="auth-screen hidden">
        <div class="auth-container">
            <div class="auth-title">üîì Sign In</div>
            <div class="auth-subtitle">Welcome back to Asset Manager</div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="signinEmail" placeholder="you@example.com">
            </div>

            <div class="form-group">
                <label>Password</label>
                <input type="password" id="signinPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            </div>

            <button class="btn btn-primary" onclick="handleSignin()">üîì Sign In</button>

            <div id="authError" class="message message-error hidden" style="margin-top: 16px;">
                <div class="message-icon">‚úï</div>
                <div id="authErrorText">Invalid email or password</div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="main-container">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-title">üì¶ Inventory</div>
                    <div class="sidebar-subtitle">Management System</div>
                </div>

                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a onclick="switchView('items')" class="active" id="menuViewItems">
                            <span>üì¶</span> View Items
                            <span style="font-size: 11px; color: #94a3b8; margin-left: auto;" id="itemsCountBadge">0</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a onclick="switchView('consumables')" id="menuViewConsumables">
                            <span>üõ†Ô∏è</span> View Consumables
                            <span style="font-size: 11px; color: #94a3b8; margin-left: auto;" id="consumablesCountBadge">0</span>
                        </a>
                    </li>
                </ul>

                <div class="sidebar-section-title">Management</div>

                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a onclick="switchView('manage')" id="menuManage">
                            <span>‚öôÔ∏è</span> Manage
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a onclick="switchView('members')" id="menuMembers">
                            <span>üë•</span> Members
                        </a>
                    </li>
                </ul>

                <div class="sidebar-section-title">Account</div>

                <ul class="sidebar-menu">
                    <li class="sidebar-menu-item">
                        <a onclick="switchView('settings')" id="menuSettings">
                            <span>‚öôÔ∏è</span> Settings
                        </a>
                    </li>
                </ul>

                <div class="sidebar-footer">
                    <button class="btn btn-secondary btn-sm" style="flex: 1;" onclick="toggleTheme()">
                        <span id="themeIcon">üåô</span> Theme
                    </button>
                    <button class="btn btn-secondary btn-sm" style="flex: 1;" onclick="handleLogout()">
                        Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="content">
                <div class="header">
                    <div class="header-title" id="pageTitle">üì¶ Inventory Items</div>
                    <div class="header-right">
                        <div class="user-profile">
                            <div class="user-avatar" id="userAvatar">A</div>
                            <div class="user-info">
                                <div class="user-name" id="userName">Admin</div>
                                <div class="user-email" id="userEmail">admin@example.com</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="content-area">
                    <!-- Items View -->
                    <div id="itemsView" class="view active">
                        <div class="items-header">
                            <div class="items-count">
                                <span class="items-count-number" id="itemsCountDisplay">0</span>
                                <span>Items</span>
                            </div>
                            <input type="text" class="search-input" id="searchItems" placeholder="Search items...">
                        </div>

                        <div class="table-container">
                            <table id="itemsTable">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Serial Number</th>
                                        <th>Holder</th>
                                        <th>Status</th>
                                        <th>Condition</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="itemsTableBody">
                                    <tr><td colspan="6" style="text-align: center; color: #94a3b8;">No items found</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Consumables View -->
                    <div id="consumablesView" class="view hidden">
                        <div class="items-header">
                            <div class="items-count">
                                <span class="items-count-number" id="consumablesCountDisplay">0</span>
                                <span>Consumables</span>
                            </div>
                            <input type="text" class="search-input" id="searchConsumables" placeholder="Search consumables...">
                        </div>

                        <div class="table-container">
                            <table id="consumablesTable">
                                <thead>
                                    <tr>
                                        <th>Item Name</th>
                                        <th>Part Number</th>
                                        <th>Quantity</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="consumablesTableBody">
                                    <tr><td colspan="4" style="text-align: center; color: #94a3b8;">No consumables found</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Manage View -->
                    <div id="manageView" class="view hidden">
                        <div class="items-count" style="margin-bottom: 24px;">üìã Manage Inventory</div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer;" onclick="openAddItemTypeModal()">
                                <div style="font-size: 32px; margin-bottom: 12px;">‚ûï</div>
                                <div style="font-weight: 600; font-size: 16px;">Add Item</div>
                                <div style="color: #64748b; font-size: 13px;">Create new asset or consumable</div>
                            </div>
                        </div>
                    </div>

                    <!-- Members View -->
                    <div id="membersView" class="view hidden">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
                            <div class="items-count">üë• Members</div>
                            <button class="btn btn-primary" style="width: auto;" onclick="openAddMemberModal()">‚ûï Add Member</button>
                        </div>
                        <div class="members-grid" id="membersGrid">
                            <div style="grid-column: 1 / -1; text-align: center; color: #94a3b8;">No members found</div>
                        </div>
                    </div>

                    <!-- Settings View -->
                    <div id="settingsView" class="view hidden">
                        <div class="items-count" style="margin-bottom: 24px;">‚öôÔ∏è Settings</div>
                        <div style="display: grid; gap: 16px;">
                            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer;" onclick="openEditProfileModal()">
                                <div style="font-weight: 600; margin-bottom: 8px;">‚úèÔ∏è Edit Profile</div>
                                <div style="color: #64748b; font-size: 13px;">Update your information</div>
                            </div>
                            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer;" onclick="openChangePasswordModal()">
                                <div style="font-weight: 600; margin-bottom: 8px;">üîê Change Password</div>
                                <div style="color: #64748b; font-size: 13px;">Update your password</div>
                            </div>
                            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer;" onclick="exportToFile()">
                                <div style="font-weight: 600; margin-bottom: 8px;">üì§ Export to File</div>
                                <div style="color: #64748b; font-size: 13px;">Download backup JSON</div>
                            </div>
                            <div style="background: white; border: 1px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer;" onclick="syncFromGithub()">
                                <div style="font-weight: 600; margin-bottom: 8px;">‚òÅÔ∏è Sync from GitHub</div>
                                <div style="color: #64748b; font-size: 13px;">Reload data from repository</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals - Item Type Modal -->
    <div id="itemTypeModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">‚ûï Add Item</div>
            <div class="modal-body">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer; text-align: center;" onclick="openAddAssetModal()">
                        <div style="font-size: 36px; margin-bottom: 12px;">üì¶</div>
                        <div style="font-weight: 600;">Asset Item</div>
                    </div>
                    <div style="background: white; border: 2px solid #e2e8f0; border-radius: 8px; padding: 20px; cursor: pointer; text-align: center;" onclick="openAddConsumableModal()">
                        <div style="font-size: 36px; margin-bottom: 12px;">üõ†Ô∏è</div>
                        <div style="font-weight: 600;">Consumable Item</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('itemTypeModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Add Asset Modal -->
    <div id="addAssetModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">‚ûï Add Asset</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Item Name *</label>
                    <input type="text" id="addAssetName" placeholder="Enter item name">
                </div>
                <div class="form-group">
                    <label>Serial Number *</label>
                    <input type="text" id="addAssetSerial" placeholder="Enter serial number">
                </div>
                <div class="form-group">
                    <label>Condition *</label>
                    <select id="addAssetCondition">
                        <option value="">Select condition</option>
                        <option value="Working">‚úì Working</option>
                        <option value="Not Working">‚úó Not Working</option>
                        <option value="N/A">N/A</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addAssetModal')">Cancel</button>
                <button class="btn btn-primary" style="width: auto;" onclick="addAsset()">Add Asset</button>
            </div>
        </div>
    </div>

    <!-- Add Consumable Modal -->
    <div id="addConsumableModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">‚ûï Add Consumable</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Item Name *</label>
                    <input type="text" id="addConsumableName" placeholder="Enter item name">
                </div>
                <div class="form-group">
                    <label>Part Number *</label>
                    <input type="text" id="addConsumablePartNumber" placeholder="Enter part number">
                </div>
                <div class="form-group">
                    <label>Quantity *</label>
                    <input type="number" id="addConsumableQuantity" placeholder="Enter quantity" min="0">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addConsumableModal')">Cancel</button>
                <button class="btn btn-primary" style="width: auto;" onclick="addConsumable()">Add</button>
            </div>
        </div>
    </div>

    <!-- Add Member Modal -->
    <div id="addMemberModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">üë§ Add Member</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="memberName" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="memberEmail" placeholder="Enter email">
                </div>
                <div class="form-group">
                    <label>Mobile</label>
                    <input type="tel" id="memberMobile" placeholder="Enter mobile">
                </div>
                <div class="form-group">
                    <label>Designation</label>
                    <input type="text" id="memberDesignation" placeholder="Enter designation">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" id="memberDepartment" placeholder="Enter department">
                </div>
                <div class="form-group">
                    <label>Password * (Min 6)</label>
                    <input type="password" id="memberPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>Confirm Password *</label>
                    <input type="password" id="memberConfirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addMemberModal')">Cancel</button>
                <button class="btn btn-primary" style="width: auto;" onclick="addMember()">Add Member</button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">‚úèÔ∏è Edit Profile</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="editName">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail">
                </div>
                <div class="form-group">
                    <label>Mobile</label>
                    <input type="tel" id="editMobile">
                </div>
                <div class="form-group">
                    <label>Designation</label>
                    <input type="text" id="editDesignation">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" id="editDepartment">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('editProfileModal')">Cancel</button>
                <button class="btn btn-primary" style="width: auto;" onclick="saveProfile()">Save</button>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">üîê Change Password</div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Current Password *</label>
                    <input type="password" id="currentPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>New Password *</label>
                    <input type="password" id="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <div class="form-group">
                    <label>Confirm Password *</label>
                    <input type="password" id="confirmNewPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('changePasswordModal')">Cancel</button>
                <button class="btn btn-primary" style="width: auto;" onclick="updatePassword()">Update</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ================== CONFIGURATION ==================
        const GITHUB_USERNAME = 'riyasma07';
        const GITHUB_DB_REPO = 'asset-manager-db';
        const GITHUB_DB_BRANCH = 'main';
        const DATA_URL = `https://raw.githubusercontent.com/${GITHUB_USERNAME}/${GITHUB_DB_REPO}/${GITHUB_DB_BRANCH}/data.json?t=${Date.now()}`;

        // ================== GLOBAL STATE ==================
        let currentUser = null;
        let items = [];
        let consumables = [];
        let members = [];
        let allUsers = [];

        // ================== INITIALIZATION ==================
        async function initApp() {
            try {
                console.log('Initializing app...');
                await loadDataFromGithub();
                
                // Check if we have valid admin data
                if (!currentUser) {
                    showToast('warning', 'No admin user found. Using demo mode.');
                    // Demo admin for testing
                    currentUser = {
                        id: 1,
                        name: 'Admin',
                        email: 'admin@example.com',
                        password: 'password123',
                        isAdmin: true
                    };
                }
                
                document.getElementById('loadingScreen').style.display = 'none';
                showAuthScreen();
                applyTheme();
                setupEventListeners();
                
                console.log('App initialized. Current user:', currentUser ? currentUser.name : 'none');
            } catch (error) {
                console.error('Init error:', error);
                document.getElementById('loadingScreen').style.display = 'none';
                showAuthScreen();
                showToast('warning', 'Demo mode: Use admin@example.com / password123');
            }
        }

        function setupEventListeners() {
            document.getElementById('searchItems')?.addEventListener('input', filterItems);
            document.getElementById('searchConsumables')?.addEventListener('input', filterConsumables);
        }

        function filterItems() {
            const query = document.getElementById('searchItems').value.toLowerCase();
            document.querySelectorAll('#itemsTableBody tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(query) ? '' : 'none';
            });
        }

        function filterConsumables() {
            const query = document.getElementById('searchConsumables').value.toLowerCase();
            document.querySelectorAll('#consumablesTableBody tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(query) ? '' : 'none';
            });
        }

        // ================== GITHUB DATA LOADING ==================
        async function loadDataFromGithub() {
            try {
                console.log('Fetching from:', DATA_URL);
                const response = await fetch(DATA_URL, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);

                const data = await response.json();
                console.log('Data from GitHub:', data);

                // Safely parse data with null checks
                if (data && typeof data === 'object') {
                    currentUser = data.user || null;
                    items = Array.isArray(data.items) ? data.items : [];
                    consumables = Array.isArray(data.consumables) ? data.consumables : [];
                    members = Array.isArray(data.members) ? data.members : [];

                    allUsers = [];
                    if (data.user) allUsers.push(data.user);
                    if (Array.isArray(data.members)) allUsers.push(...data.members);

                    console.log('Parsed:', { currentUser, items: items.length, consumables: consumables.length, members: members.length });
                }
            } catch (error) {
                console.error('GitHub load error:', error);
                loadFromLocalStorage();
            }
        }

        function loadFromLocalStorage() {
            const user = localStorage.getItem('currentUser');
            if (user) {
                try {
                    currentUser = JSON.parse(user);
                } catch (e) {
                    console.error('LocalStorage parse error:', e);
                }
            }
        }

        async function syncFromGithub() {
            showToast('info', 'Syncing...');
            try {
                await loadDataFromGithub();
                renderAll();
                showToast('success', 'Synced!');
            } catch (error) {
                showToast('error', 'Sync failed');
            }
        }

        // ================== AUTH ==================
        function handleSignin() {
            const email = document.getElementById('signinEmail').value.trim();
            const password = document.getElementById('signinPassword').value;

            if (!email || !password) {
                showAuthError('Enter email and password');
                return;
            }

            console.log('Attempting login with:', email);
            console.log('Available users:', allUsers);

            // Check admin user first
            if (currentUser && currentUser.email === email && currentUser.password === password) {
                console.log('Admin login successful');
                showMainApp();
                renderAll();
                updateUserProfile();
                showToast('success', 'Signed in!');
                return;
            }

            // Check members
            const member = members.find(m => m.email === email && m.password === password);
            if (member) {
                currentUser = member;
                console.log('Member login successful:', member.name);
                showMainApp();
                renderAll();
                updateUserProfile();
                showToast('success', 'Signed in!');
                return;
            }

            // Check allUsers array
            const user = allUsers.find(u => u && u.email === email && u.password === password);
            if (user) {
                currentUser = user;
                console.log('User login successful:', user.name);
                showMainApp();
                renderAll();
                updateUserProfile();
                showToast('success', 'Signed in!');
                return;
            }

            showAuthError('Invalid email or password');
            console.log('Login failed. Email:', email);
        }

        function showAuthError(message) {
            document.getElementById('authErrorText').textContent = message;
            document.getElementById('authError').classList.remove('hidden');
        }

        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showAuthScreen();
            document.getElementById('signinEmail').value = '';
            document.getElementById('signinPassword').value = '';
            document.getElementById('authError').classList.add('hidden');
            showToast('success', 'Logged out');
        }

        // ================== UI ==================
        function showAuthScreen() {
            document.getElementById('authScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
        }

        function switchView(name) {
            document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
            document.querySelectorAll('.sidebar-menu-item a').forEach(a => a.classList.remove('active'));
            
            const viewEl = document.getElementById(name + 'View');
            if (viewEl) viewEl.classList.remove('hidden');
            
            const menuEl = document.getElementById('menu' + name.charAt(0).toUpperCase() + name.slice(1));
            if (menuEl) menuEl.classList.add('active');
            
            const titles = {
                'items': 'üì¶ Inventory Items',
                'consumables': 'üõ†Ô∏è Consumable Items',
                'manage': '‚öôÔ∏è Manage Inventory',
                'members': 'üë• Members',
                'settings': '‚öôÔ∏è Settings'
            };
            document.getElementById('pageTitle').textContent = titles[name] || '';
        }

        function updateUserProfile() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.name || 'User';
                document.getElementById('userEmail').textContent = currentUser.email || '';
                const name = String(currentUser.name || '?');
                const initials = name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                document.getElementById('userAvatar').textContent = initials || '?';
            }
        }

        // ================== MODALS ==================
        function openModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.remove('hidden');
        }

        function closeModal(id) {
            const modal = document.getElementById(id);
            if (modal) modal.classList.add('hidden');
        }

        function openAddItemTypeModal() {
            openModal('itemTypeModal');
        }

        function openAddAssetModal() {
            closeModal('itemTypeModal');
            document.getElementById('addAssetName').value = '';
            document.getElementById('addAssetSerial').value = '';
            document.getElementById('addAssetCondition').value = '';
            openModal('addAssetModal');
        }

        function openAddConsumableModal() {
            closeModal('itemTypeModal');
            document.getElementById('addConsumableName').value = '';
            document.getElementById('addConsumablePartNumber').value = '';
            document.getElementById('addConsumableQuantity').value = '';
            openModal('addConsumableModal');
        }

        function openAddMemberModal() {
            openModal('addMemberModal');
        }

        function openEditProfileModal() {
            if (currentUser) {
                document.getElementById('editName').value = currentUser.name || '';
                document.getElementById('editEmail').value = currentUser.email || '';
                document.getElementById('editMobile').value = currentUser.mobile || '';
                document.getElementById('editDesignation').value = currentUser.designation || '';
                document.getElementById('editDepartment').value = currentUser.department || '';
            }
            openModal('editProfileModal');
        }

        function openChangePasswordModal() {
            openModal('changePasswordModal');
        }

        // ================== ASSETS ==================
        async function addAsset() {
            const name = document.getElementById('addAssetName').value.trim();
            const serial = document.getElementById('addAssetSerial').value.trim();
            const condition = document.getElementById('addAssetCondition').value;

            if (!name || !serial || !condition) {
                showToast('error', 'Fill all required fields');
                return;
            }

            items.push({
                id: Date.now(),
                name,
                serial,
                condition: String(condition),
                status: 'Available',
                holder: '-',
                history: [{ timestamp: new Date().toISOString(), action: 'Added', member: currentUser?.name || 'Admin' }],
                createdAt: new Date().toISOString()
            });

            closeModal('addAssetModal');
            renderItems();
            showToast('success', 'Asset added');
        }

        // ================== CONSUMABLES ==================
        async function addConsumable() {
            const name = document.getElementById('addConsumableName').value.trim();
            const part = document.getElementById('addConsumablePartNumber').value.trim();
            const qty = parseInt(document.getElementById('addConsumableQuantity').value) || 0;

            if (!name || !part || qty < 0) {
                showToast('error', 'Fill all required fields');
                return;
            }

            consumables.push({
                id: Date.now(),
                name,
                partNumber: String(part),
                quantity: qty,
                history: [{ timestamp: new Date().toISOString(), action: 'Added', member: currentUser?.name || 'Admin' }],
                createdAt: new Date().toISOString()
            });

            closeModal('addConsumableModal');
            renderConsumables();
            showToast('success', 'Consumable added');
        }

        // ================== MEMBERS ==================
        async function addMember() {
            const name = document.getElementById('memberName').value.trim();
            const email = document.getElementById('memberEmail').value.trim();
            const pass = document.getElementById('memberPassword').value;
            const confirm = document.getElementById('memberConfirmPassword').value;

            if (!name || !email || !pass) {
                showToast('error', 'Fill required fields');
                return;
            }

            if (pass !== confirm) {
                showToast('error', 'Passwords don\'t match');
                return;
            }

            if (pass.length < 6) {
                showToast('error', 'Min 6 characters');
                return;
            }

            const newMember = {
                id: Date.now(),
                name,
                email,
                password: pass,
                mobile: document.getElementById('memberMobile').value.trim() || '',
                designation: document.getElementById('memberDesignation').value.trim() || '',
                department: document.getElementById('memberDepartment').value.trim() || '',
                createdAt: new Date().toISOString()
            };

            members.push(newMember);
            allUsers.push(newMember);
            closeModal('addMemberModal');
            renderMembers();
            showToast('success', 'Member added');
        }

        // ================== PROFILE ==================
        async function saveProfile() {
            if (currentUser) {
                currentUser.name = document.getElementById('editName').value.trim();
                currentUser.email = document.getElementById('editEmail').value.trim();
                currentUser.mobile = document.getElementById('editMobile').value.trim();
                currentUser.designation = document.getElementById('editDesignation').value.trim();
                currentUser.department = document.getElementById('editDepartment').value.trim();
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                closeModal('editProfileModal');
                updateUserProfile();
                showToast('success', 'Saved');
            }
        }

        async function updatePassword() {
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmNewPassword').value;

            if (!current || !newPass || !confirm) {
                showToast('error', 'Fill all fields');
                return;
            }

            if (currentUser.password !== current) {
                showToast('error', 'Wrong current password');
                return;
            }

            if (newPass !== confirm) {
                showToast('error', 'Passwords don\'t match');
                return;
            }

            if (newPass.length < 6) {
                showToast('error', 'Min 6 characters');
                return;
            }

            currentUser.password = newPass;
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            closeModal('changePasswordModal');
            showToast('success', 'Password updated');
        }

        // ================== RENDER ==================
        function renderAll() {
            renderItems();
            renderConsumables();
            renderMembers();
        }

        function renderItems() {
            try {
                const tbody = document.getElementById('itemsTableBody');
                if (!tbody) return;

                document.getElementById('itemsCountDisplay').textContent = items.length;
                document.getElementById('itemsCountBadge').textContent = items.length;

                if (!items || items.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#94a3b8;">No items</td></tr>';
                    return;
                }

                tbody.innerHTML = items.map(item => {
                    const condition = String(item.condition || 'N/A').toLowerCase().replace(/\s/g, '');
                    const status = String(item.status || 'Available').toLowerCase();
                    return `
                        <tr>
                            <td>${String(item.name || '')}</td>
                            <td>${String(item.serial || '')}</td>
                            <td>${String(item.holder || '')}</td>
                            <td><span class="status-badge status-${status}">${status === 'available' ? '‚úì' : '‚¨§'} ${item.status || ''}</span></td>
                            <td><span class="condition-badge condition-${condition}">${item.condition || ''}</span></td>
                            <td><div class="action-buttons" style="opacity:0.5;">üìã</div></td>
                        </tr>
                    `;
                }).join('');
            } catch (error) {
                console.error('renderItems error:', error);
            }
        }

        function renderConsumables() {
            try {
                const tbody = document.getElementById('consumablesTableBody');
                if (!tbody) return;

                document.getElementById('consumablesCountDisplay').textContent = consumables.length;
                document.getElementById('consumablesCountBadge').textContent = consumables.length;

                if (!consumables || consumables.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#94a3b8;">No consumables</td></tr>';
                    return;
                }

                tbody.innerHTML = consumables.map(c => `
                    <tr>
                        <td>${String(c.name || '')}</td>
                        <td>${String(c.partNumber || '')}</td>
                        <td><strong>${c.quantity || 0}</strong></td>
                        <td><div class="action-buttons" style="opacity:0.5;">üìã</div></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('renderConsumables error:', error);
            }
        }

        function renderMembers() {
            try {
                const grid = document.getElementById('membersGrid');
                if (!grid) return;

                if (!members || members.length === 0) {
                    grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:#94a3b8;">No members</div>';
                    return;
                }

                grid.innerHTML = members.map(m => {
                    const initials = String(m.name || '?').split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                    return `
                        <div class="member-card">
                            <div class="member-card-header">
                                <div class="member-avatar">${initials}</div>
                                <div><div class="member-name">${String(m.name || '')}</div><div class="member-info">${String(m.designation || 'Member')}</div></div>
                            </div>
                            <div class="member-info"><strong>Email:</strong> ${String(m.email || 'N/A')}</div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('renderMembers error:', error);
            }
        }

        function exportToFile() {
            const data = { user: currentUser, items, consumables, members, exportedAt: new Date().toISOString() };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('success', 'Exported');
        }

        // ================== THEME ==================
        function toggleTheme() {
            const html = document.documentElement;
            html.classList.toggle('dark');
            localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
            document.getElementById('themeIcon').textContent = html.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
        }

        function applyTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
        }

        // ================== TOAST ==================
        function showToast(type, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<span class="message-icon">${icons[type] || '‚Ä¢'}</span><span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ================== START ==================
        window.addEventListener('DOMContentLoaded', initApp);

        // Close modals on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal:not(.hidden)').forEach(m => m.classList.add('hidden'));
            }
        });

        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.classList.add('hidden');
            });
        });
    </script>
</body>
</html>
