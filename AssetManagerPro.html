<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Manager Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        
        .auth-page { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .auth-card { background: white; border-radius: 12px; padding: 40px; width: 100%; max-width: 500px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
        .card-title { text-align: center; font-size: 28px; color: #333; margin-bottom: 10px; }
        .card-subtitle { text-align: center; color: #888; font-size: 14px; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #333; font-weight: 600; margin-bottom: 5px; font-size: 13px; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; font-family: inherit; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102,126,234,0.1); }
        
        .btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 5px; font-weight: 600; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(102,126,234,0.4); }
        .btn-small { padding: 6px 10px; font-size: 12px; width: auto; margin-right: 5px; }
        .link { text-align: center; margin-top: 15px; font-size: 14px; }
        .link a { color: #667eea; cursor: pointer; text-decoration: none; font-weight: 600; }
        .link a:hover { text-decoration: underline; }
        
        .page { display: none; }
        .page.active { display: block; }
        
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 24px; }
        .header .right { display: flex; gap: 15px; align-items: center; }
        
        .main-app { display: flex; min-height: calc(100vh - 70px); }
        .sidebar { width: 220px; background: #f8f8f8; border-right: 1px solid #ddd; padding: 20px; overflow-y: auto; }
        .menu-group { margin-bottom: 25px; }
        .menu-title { font-size: 12px; font-weight: 700; color: #999; text-transform: uppercase; margin-bottom: 10px; }
        .menu-item { padding: 10px 12px; cursor: pointer; border-radius: 5px; color: #333; font-size: 14px; margin-bottom: 5px; transition: 0.2s; }
        .menu-item:hover { background: #e0e0e0; }
        .menu-item.active { background: #667eea; color: white; font-weight: 600; }
        
        .content { flex: 1; padding: 40px; overflow-y: auto; }
        .page-title { font-size: 28px; color: #333; margin-bottom: 20px; }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 5px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        thead { background: #f8f8f8; border-bottom: 2px solid #ddd; }
        th { padding: 12px; text-align: left; font-weight: 600; color: #333; font-size: 13px; }
        td { padding: 12px; border-bottom: 1px solid #eee; color: #333; font-size: 14px; }
        tr:hover { background: #f9f9f9; }
        
        /* NEW: Condition Badge Styles */
        .badge { display: inline-block; padding: 6px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; }
        .badge-working { background: #dcfce7; color: #166534; }
        .badge-notworking { background: #fee2e2; color: #991b1b; }
        .badge-na { background: #fed7aa; color: #b45309; }
        
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 10px; padding: 30px; max-width: 450px; width: 90%; box-shadow: 0 10px 40px rgba(0,0,0,0.3); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-header h2 { font-size: 20px; color: #333; }
        .close { background: none; border: none; font-size: 28px; cursor: pointer; color: #999; }
        .modal-footer { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; }
        .btn-cancel { background: #e0e0e0; color: #333; padding: 10px 20px; }
        
        @media (max-width: 768px) {
            .main-app { flex-direction: column; }
            .sidebar { width: 100%; border-right: none; border-bottom: 1px solid #ddd; }
            .content { padding: 20px; }
        }
    </style>
</head>
<body>

<!-- AUTH PAGE -->
<div id="authPage" class="page active">
    <!-- LOGIN CARD -->
    <div id="loginCard" class="auth-page" style="display: none;">
        <div class="auth-card">
            <h1 class="card-title">üîê Asset Manager Pro</h1>
            <p class="card-subtitle">Professional Inventory System</p>
            <form onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn">üîì Sign In</button>
                <div class="link">New user? <a onclick="toggleAuth()">Create Account</a></div>
            </form>
        </div>
    </div>

    <!-- SETUP CARD -->
    <div id="setupCard" class="auth-page">
        <div class="auth-card">
            <h1 class="card-title">üîß First Time Setup</h1>
            <p class="card-subtitle">You will be the admin</p>
            <form onsubmit="handleSetup(event)">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" id="setupFullName" required>
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="setupEmail" required>
                </div>
                <div class="form-group">
                    <label>Mobile</label>
                    <input type="tel" id="setupMobile">
                </div>
                <div class="form-group">
                    <label>Designation</label>
                    <input type="text" id="setupDesignation">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <input type="text" id="setupDepartment">
                </div>
                <div class="form-group">
                    <label>Password * (Min 6)</label>
                    <input type="password" id="setupPassword" required minlength="6">
                </div>
                <div class="form-group">
                    <label>Confirm Password *</label>
                    <input type="password" id="setupConfirmPassword" required>
                </div>
                <button type="submit" class="btn">üëë Create Admin Account</button>
                <div class="link"><a onclick="toggleAuth()">Already registered? Sign In</a></div>
            </form>
        </div>
    </div>
</div>

<!-- MAIN APP PAGE -->
<div id="mainAppPage" class="page">
    <div class="header">
        <h1 id="pageTitle">üì¶ Inventory Items</h1>
        <div class="right">
            <span id="userName">User</span>
            <button class="btn btn-small" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="main-app">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="menu-group">
                <div class="menu-title">üìã Menu</div>
                <div class="menu-item active" onclick="showPage('items')">üì¶ View Items</div>
                <div class="menu-item" onclick="showPage('addItem')">‚ûï Add Item</div>
                <div class="menu-item" onclick="showPage('members')">üë• View Members</div>
                <div class="menu-item" onclick="showPage('addMember')">üë§ Add Member</div>
            </div>
            <div class="menu-group">
                <div class="menu-title">‚öôÔ∏è Settings</div>
                <div class="menu-item" onclick="editProfile()">‚úèÔ∏è Edit Profile</div>
                <div class="menu-item" onclick="changePassword()">üîê Change Password</div>
                <div class="menu-item" onclick="syncGitHub()">‚òÅÔ∏è Sync GitHub</div>
            </div>
        </div>

        <!-- CONTENT -->
        <div class="content">
            <!-- ITEMS PAGE -->
            <div id="itemsContent">
                <div class="page-title">üì¶ Inventory Items</div>
                <button class="btn" style="width: auto; margin-bottom: 20px;" onclick="openModal('addItemModal')">‚ûï Add Item</button>
                <p style="margin-bottom: 15px; color: #666;">Total Items: <strong id="itemCount">0</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>Item Name</th>
                            <th>Serial Number</th>
                            <th>Holder</th>
                            <th>Condition</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="itemsTableBody">
                        <tr><td colspan="5" style="text-align: center; color: #999;">No items found</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ADD ITEM PAGE -->
            <div id="addItemContent" style="display: none;">
                <div class="page-title">‚ûï Add Item</div>
                <div style="max-width: 500px;">
                    <form onsubmit="handleAddItem(event)">
                        <div class="form-group">
                            <label>Item Name *</label>
                            <input type="text" id="formItemName" required>
                        </div>
                        <div class="form-group">
                            <label>Serial Number *</label>
                            <input type="text" id="formItemSerial" required>
                        </div>
                        <div class="form-group">
                            <label>Condition *</label>
                            <select id="formItemCondition" required>
                                <option value="">Select Condition</option>
                                <option value="‚úì Working">‚úì Working</option>
                                <option value="‚úó Not Working">‚úó Not Working</option>
                                <option value="N/A">N/A</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-cancel" onclick="showPage('items')">Cancel</button>
                            <button type="submit" class="btn">Add Item</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- MEMBERS PAGE -->
            <div id="membersContent" style="display: none;">
                <div class="page-title">üë• Members</div>
                <button class="btn" style="width: auto; margin-bottom: 20px;" onclick="showPage('addMember')">üë§ Add Member</button>
                <p style="margin-bottom: 15px; color: #666;">Total Members: <strong id="memberCount">0</strong></p>
                <table>
                    <thead>
                        <tr>
                            <th>Full Name</th>
                            <th>Email</th>
                            <th>Mobile</th>
                            <th>Designation</th>
                            <th>Department</th>
                        </tr>
                    </thead>
                    <tbody id="membersTableBody">
                        <tr><td colspan="5" style="text-align: center; color: #999;">No members found</td></tr>
                    </tbody>
                </table>
            </div>

            <!-- ADD MEMBER PAGE -->
            <div id="addMemberContent" style="display: none;">
                <div class="page-title">üë§ Add Member</div>
                <div style="max-width: 500px;">
                    <form onsubmit="handleAddMember(event)">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="formMemberName" required>
                        </div>
                        <div class="form-group">
                            <label>Email *</label>
                            <input type="email" id="formMemberEmail" required>
                        </div>
                        <div class="form-group">
                            <label>Mobile</label>
                            <input type="tel" id="formMemberMobile">
                        </div>
                        <div class="form-group">
                            <label>Designation</label>
                            <input type="text" id="formMemberDesignation">
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <input type="text" id="formMemberDepartment">
                        </div>
                        <div class="form-group">
                            <label>Password * (Min 6)</label>
                            <input type="password" id="formMemberPassword" required minlength="6">
                        </div>
                        <div class="form-group">
                            <label>Confirm Password *</label>
                            <input type="password" id="formMemberConfirmPassword" required>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-cancel" onclick="showPage('members')">Cancel</button>
                            <button type="submit" class="btn">Add Member</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MODALS -->
<div id="addItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>‚ûï Add Item</h2>
            <button class="close" onclick="closeModal('addItemModal')">√ó</button>
        </div>
        <form onsubmit="handleAddItemModal(event)">
            <div class="form-group">
                <label>Item Name *</label>
                <input type="text" id="modalItemName" required>
            </div>
            <div class="form-group">
                <label>Serial Number *</label>
                <input type="text" id="modalItemSerial" required>
            </div>
            <div class="form-group">
                <label>Condition *</label>
                <select id="modalItemCondition" required>
                    <option value="">Select Condition</option>
                    <option value="‚úì Working">‚úì Working</option>
                    <option value="‚úó Not Working">‚úó Not Working</option>
                    <option value="N/A">N/A</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal('addItemModal')">Cancel</button>
                <button type="submit" class="btn">Add Item</button>
            </div>
        </form>
    </div>
</div>

<div id="assignItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üì§ Assign Item</h2>
            <button class="close" onclick="closeModal('assignItemModal')">√ó</button>
        </div>
        <form onsubmit="handleAssignItem(event)">
            <div class="form-group">
                <label>Select Member *</label>
                <select id="assignMemberSelect" required>
                    <option value="">Choose member</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-cancel" onclick="closeModal('assignItemModal')">Cancel</button>
                <button type="submit" class="btn">Assign</button>
            </div>
        </form>
    </div>
</div>

<div id="deleteItemModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üóëÔ∏è Delete Item</h2>
            <button class="close" onclick="closeModal('deleteItemModal')">√ó</button>
        </div>
        <p style="margin: 15px 0; color: #666;">This action cannot be undone. Are you sure?</p>
        <div class="modal-footer">
            <button type="button" class="btn btn-cancel" onclick="closeModal('deleteItemModal')">Cancel</button>
            <button type="button" class="btn" onclick="confirmDeleteItem()">Delete</button>
        </div>
    </div>
</div>

<!-- NEW: Notification Modal -->
<div id="notificationModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>üìß Send Notification</h2>
            <button class="close" onclick="closeModal('notificationModal')">√ó</button>
        </div>
        <p id="notificationMessage" style="margin: 15px 0; color: #666;"></p>
        <div class="modal-footer">
            <button type="button" class="btn btn-cancel" onclick="closeModal('notificationModal')">Cancel</button>
            <button type="button" class="btn" onclick="confirmNotification()">Send</button>
        </div>
    </div>
</div>

<script>
    // Keep all your existing code exactly as is
    // Just replace this entire script section with your original 800+ line script
    // And ADD these functions at the end:

    let allItems = { items: [], members: [], emails: [] };
    let currentUser = null;
    let appInitialized = false;
    let pendingDeleteIdx = null;
    let pendingAssignIdx = null;
    let pendingNotifyIdx = null;

    function waitForData() {
        if (typeof window.assetManagerData !== 'undefined') {
            allItems = window.assetManagerData;
            console.log('‚úì Data loaded');
            initializeApp();
        } else if (!appInitialized) {
            setTimeout(waitForData, 300);
        }
    }

    function initializeApp() {
        if (appInitialized) return;
        appInitialized = true;
        if (!allItems.members || allItems.members.length === 0) {
            document.getElementById('setupCard').style.display = 'flex';
            document.getElementById('loginCard').style.display = 'none';
        } else {
            document.getElementById('loginCard').style.display = 'flex';
            document.getElementById('setupCard').style.display = 'none';
        }
    }

    function toggleAuth() {
        const login = document.getElementById('loginCard');
        const setup = document.getElementById('setupCard');
        login.style.display = login.style.display === 'none' ? 'flex' : 'none';
        setup.style.display = setup.style.display === 'none' ? 'flex' : 'none';
    }

    async function handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const pwd = document.getElementById('loginPassword').value;
        const user = allItems.members && allItems.members.find(m => m && m.email === email && m.password === pwd);
        if (!user) {
            alert('‚ùå Invalid credentials');
            return;
        }
        currentUser = user;
        showMainApp();
    }

    async function handleSetup(e) {
        e.preventDefault();
        const pwd = document.getElementById('setupPassword').value;
        const confirm = document.getElementById('setupConfirmPassword').value;
        if (pwd !== confirm) {
            alert('‚ùå Passwords do not match');
            return;
        }
        const admin = {
            id: Date.now(),
            fullName: document.getElementById('setupFullName').value,
            email: document.getElementById('setupEmail').value,
            password: pwd,
            mobile: document.getElementById('setupMobile').value,
            designation: document.getElementById('setupDesignation').value,
            department: document.getElementById('setupDepartment').value,
            role: 'admin',
            createdDate: new Date().toISOString()
        };
        if (!allItems.members) allItems.members = [];
        allItems.members.push(admin);
        currentUser = admin;
        window.saveData(allItems);
        alert('‚úÖ Admin created!');
        location.reload();
    }

    function showMainApp() {
        document.getElementById('authPage').style.display = 'none';
        document.getElementById('mainAppPage').style.display = 'block';
        document.getElementById('userName').textContent = currentUser.fullName;
        showPage('items');
    }

    function logout() {
        currentUser = null;
        document.getElementById('authPage').style.display = 'block';
        document.getElementById('mainAppPage').style.display = 'none';
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
    }

    function showPage(page) {
        document.getElementById('itemsContent').style.display = 'none';
        document.getElementById('addItemContent').style.display = 'none';
        document.getElementById('membersContent').style.display = 'none';
        document.getElementById('addMemberContent').style.display = 'none';

        const items = document.querySelectorAll('.menu-item');
        items.forEach(item => item.classList.remove('active'));

        if (page === 'items') {
            document.getElementById('itemsContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = 'üì¶ Inventory Items';
            items[0].classList.add('active');
            displayItems();
        } else if (page === 'addItem') {
            document.getElementById('addItemContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = '‚ûï Add Item';
            items[1].classList.add('active');
        } else if (page === 'members') {
            document.getElementById('membersContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = 'üë• Members';
            items[2].classList.add('active');
            displayMembers();
        } else if (page === 'addMember') {
            document.getElementById('addMemberContent').style.display = 'block';
            document.getElementById('pageTitle').textContent = 'üë§ Add Member';
            items[3].classList.add('active');
        }
    }

    // NEW: Get condition badge class color
    function getConditionBadgeClass(condition) {
        if (condition && condition.includes('Working') && !condition.includes('Not')) {
            return 'badge-working';
        } else if (condition && condition.includes('Not')) {
            return 'badge-notworking';
        }
        return 'badge-na';
    }

    function displayItems() {
        const tbody = document.getElementById('itemsTableBody');
        document.getElementById('itemCount').textContent = allItems.items ? allItems.items.length : 0;

        if (!allItems.items || allItems.items.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">No items found</td></tr>';
            return;
        }

        tbody.innerHTML = allItems.items.map((item, idx) => {
            const holder = allItems.members && allItems.members.find(m => m && m.id === item.assignedTo);
            const badgeClass = getConditionBadgeClass(item.condition);

            return `<tr>
                <td>${item.name}</td>
                <td>${item.serialNumber}</td>
                <td>${holder ? holder.fullName : 'Unassigned'}</td>
                <td><span class="badge ${badgeClass}">${item.condition}</span></td>
                <td>
                    <button class="btn btn-small" onclick="openAssignModal(${idx})">üì§</button>
                    ${item.assignedTo ? `<button class="btn btn-small" onclick="openNotifyModal(${idx})">üîî</button>` : ''}
                    <button class="btn btn-small" onclick="openDeleteModal(${idx})">üóëÔ∏è</button>
                </td>
            </tr>`;
        }).join('');
    }

    function displayMembers() {
        const tbody = document.getElementById('membersTableBody');
        document.getElementById('memberCount').textContent = allItems.members ? allItems.members.length : 0;

        if (!allItems.members || allItems.members.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #999;">No members found</td></tr>';
            return;
        }

        tbody.innerHTML = allItems.members.map(m => `<tr>
            <td>${m.fullName}</td>
            <td>${m.email}</td>
            <td>${m.mobile || '-'}</td>
            <td>${m.designation || '-'}</td>
            <td>${m.department || '-'}</td>
        </tr>`).join('');
    }

    async function handleAddItemModal(e) {
        e.preventDefault();
        const item = {
            id: Date.now(),
            name: document.getElementById('modalItemName').value,
            serialNumber: document.getElementById('modalItemSerial').value,
            condition: document.getElementById('modalItemCondition').value,
            assignedTo: null,
            createdDate: new Date().toISOString()
        };
        if (!allItems.items) allItems.items = [];
        allItems.items.push(item);
        window.saveData(allItems);
        closeModal('addItemModal');
        displayItems();
        alert('‚úÖ Item added!');
    }

    async function handleAddItem(e) {
        e.preventDefault();
        const item = {
            id: Date.now(),
            name: document.getElementById('formItemName').value,
            serialNumber: document.getElementById('formItemSerial').value,
            condition: document.getElementById('formItemCondition').value,
            assignedTo: null,
            createdDate: new Date().toISOString()
        };
        if (!allItems.items) allItems.items = [];
        allItems.items.push(item);
        window.saveData(allItems);
        showPage('items');
        alert('‚úÖ Item added!');
    }

    function openAssignModal(idx) {
        pendingAssignIdx = idx;
        const select = document.getElementById('assignMemberSelect');
        select.innerHTML = '<option value="">Choose member</option>';
        allItems.members.forEach((m, i) => {
            const opt = document.createElement('option');
            opt.value = i;
            opt.textContent = `${m.fullName} (${m.email})`;
            select.appendChild(opt);
        });
        openModal('assignItemModal');
    }

    async function handleAssignItem(e) {
        e.preventDefault();
        const memberIdx = parseInt(document.getElementById('assignMemberSelect').value);
        if (isNaN(memberIdx)) {
            alert('‚ùå Select a member');
            return;
        }
        allItems.items[pendingAssignIdx].assignedTo = allItems.members[memberIdx].id;
        window.saveData(allItems);
        closeModal('assignItemModal');
        displayItems();
        
        // NEW: Ask to send notification
        const member = allItems.members[memberIdx];
        const item = allItems.items[pendingAssignIdx];
        const send = confirm(`Send notification to ${member.fullName}?`);
        if (send) {
            sendItemNotification(member, item);
        }
    }

    function openDeleteModal(idx) {
        pendingDeleteIdx = idx;
        openModal('deleteItemModal');
    }

    function confirmDeleteItem() {
        allItems.items.splice(pendingDeleteIdx, 1);
        window.saveData(allItems);
        closeModal('deleteItemModal');
        displayItems();
        alert('‚úÖ Item deleted!');
    }

    // NEW: Open notification modal
    function openNotifyModal(idx) {
        pendingNotifyIdx = idx;
        const item = allItems.items[idx];
        const member = allItems.members.find(m => m && m.id === item.assignedTo);
        document.getElementById('notificationMessage').textContent = `Send notification to ${member.fullName} (${member.email}) about this item?`;
        openModal('notificationModal');
    }

    // NEW: Confirm and send notification
    function confirmNotification() {
        const item = allItems.items[pendingNotifyIdx];
        const member = allItems.members.find(m => m && m.id === item.assignedTo);
        sendItemNotification(member, item);
        closeModal('notificationModal');
    }

    // NEW: Send item notification email
    function sendItemNotification(member, item) {
        if (!allItems.emails) allItems.emails = [];
        allItems.emails.push({
            type: 'ITEM_ASSIGNMENT',
            recipient: member.email,
            subject: `Item Assigned: ${item.name}`,
            body: `Item "${item.name}" (Serial: ${item.serialNumber}) has been assigned to you.\n\nCondition: ${item.condition}`,
            timestamp: new Date().toISOString(),
            status: 'pending'
        });
        window.saveData(allItems);
        alert('‚úÖ Notification queued!');
    }

    async function handleAddMember(e) {
        e.preventDefault();
        const pwd = document.getElementById('formMemberPassword').value;
        const confirm = document.getElementById('formMemberConfirmPassword').value;

        if (pwd !== confirm) {
            alert('‚ùå Passwords do not match');
            return;
        }

        const member = {
            id: Date.now(),
            fullName: document.getElementById('formMemberName').value,
            email: document.getElementById('formMemberEmail').value,
            password: pwd,
            mobile: document.getElementById('formMemberMobile').value,
            designation: document.getElementById('formMemberDesignation').value,
            department: document.getElementById('formMemberDepartment').value,
            role: 'member',
            createdDate: new Date().toISOString()
        };

        if (!allItems.members) allItems.members = [];
        allItems.members.push(member);
        window.saveData(allItems);

        // NEW: Ask to send welcome email
        const sendEmail = confirm(`Send welcome email to ${member.email}?`);
        if (sendEmail) {
            sendWelcomeEmail(member);
        }

        showPage('members');
        alert('‚úÖ Member added!');
    }

    // NEW: Send welcome email
    function sendWelcomeEmail(member) {
        if (!allItems.emails) allItems.emails = [];
        allItems.emails.push({
            type: 'WELCOME_EMAIL',
            recipient: member.email,
            subject: 'Asset Manager Pro - Account Created',
            body: `Dear ${member.fullName},\n\nYour account has been created successfully.\n\nEmail: ${member.email}\nPassword: ${member.password}\n\nPlease change your password after first login.\n\nBest regards,\nAsset Manager Pro`,
            timestamp: new Date().toISOString(),
            status: 'pending'
        });
        window.saveData(allItems);
    }

    function editProfile() {
        alert('üë§ Edit profile feature coming soon');
    }

    function changePassword() {
        alert('üîê Change password feature coming soon');
    }

    function syncGitHub() {
        alert('‚òÅÔ∏è Sync feature coming soon');
    }

    function openModal(id) {
        document.getElementById(id).classList.add('active');
    }

    function closeModal(id) {
        document.getElementById(id).classList.remove('active');
    }

    // Start
    waitForData();
</script>

</body>
</html>